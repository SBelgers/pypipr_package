

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Preprocessing and Filtering &mdash; Pypipr 0.0.16</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=c7cdf6fe"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Baseline Correction Techniques" href="05_baseline_correction.html" />
    <link rel="prev" title="Data Loading Techniques" href="02_data_loading.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Pypipr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../pupil_measurement.html">Pupil Measurement Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_pupil_simulation.html">Pupillary Light Response Simulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="01_pupil_simulation.html#basic-pupil-response-simulation">1. Basic Pupil Response Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="01_pupil_simulation.html#customizing-simulation-parameters">2. Customizing Simulation Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="01_pupil_simulation.html#timing-parameters">Timing Parameters:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="01_pupil_simulation.html#customizing-response-parameters">3. Customizing Response Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="01_pupil_simulation.html#response-shape-parameters">Response Shape Parameters:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="01_pupil_simulation.html#comparing-different-stimulus-conditions">4. Comparing Different Stimulus Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="01_pupil_simulation.html#adding-realistic-noise-and-variations">5. Adding Realistic Noise and Variations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="02_data_loading.html">Data Loading Techniques</a><ul>
<li class="toctree-l3"><a class="reference internal" href="02_data_loading.html#how-to-use-this-notebook">How to use this notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_data_loading.html#loading-built-in-simulated-data">Loading built-in (simulated) data</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_data_loading.html#creating-synthetic-data-from-arrays">Creating synthetic data from arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_data_loading.html#working-with-existing-measurement-arrays">Working with existing measurement arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_data_loading.html#setting-and-plotting-light-stimuli">Setting and plotting light stimuli</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Preprocessing and Filtering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-this-notebook">How to use this notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-a-noisy-example-signal">Generate a noisy example signal</a></li>
<li class="toctree-l3"><a class="reference internal" href="#apply-simple-smoothing-filters">Apply simple smoothing filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inject-synthetic-blinks">Inject synthetic blinks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#try-smoothing-after-blink-injection">Try smoothing after blink injection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remove-blinks-by-marking-and-deleting-segments">Remove blinks by marking and deleting segments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trim-by-pupil-size">Trim by pupil size</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limit-sudden-rates-of-change">Limit sudden rates of change</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="05_baseline_correction.html">Baseline Correction Techniques</a><ul>
<li class="toctree-l3"><a class="reference internal" href="05_baseline_correction.html#setup-and-requirements">Setup and requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_baseline_correction.html#load-a-sample-measurement">Load a sample measurement</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_baseline_correction.html#compute-and-apply-baseline-correction">Compute and apply baseline correction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="07_pupil_metrics.html">Pupil Metrics Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="07_pupil_metrics.html#how-to-use-this-notebook">How to use this notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="07_pupil_metrics.html#quick-note">Quick note</a></li>
<li class="toctree-l3"><a class="reference internal" href="07_pupil_metrics.html#peak-constriction-and-time-to-peak">Peak constriction and time-to-peak</a></li>
<li class="toctree-l3"><a class="reference internal" href="07_pupil_metrics.html#pipr-and-average-size-at-fixed-windows">PIPR and average-size at fixed windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="07_pupil_metrics.html#shifted-stimulus-example-and-multiple-pipr-windows">Shifted-stimulus example and multiple PIPR windows</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pupil_fit.html">Pupil Fitting Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pupil_fit.html#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pupil_fitting/08_comprehensive_fitting.html">Comprehensive Fitting with PupilFit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../pupil_fitting/08_comprehensive_fitting.html#how-to-use-this-notebook">How to use this notebook</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pupil_fitting/08_comprehensive_fitting.html#phases">Phases:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pupil_fitting/08_comprehensive_fitting.html#notes">Notes:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pupil_fitting/08_comprehensive_fitting.html#baseline-fitting">Baseline fitting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pupil_fitting/08_comprehensive_fitting.html#constriction-sustain-fitting">Constriction / sustain fitting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pupil_fitting/08_comprehensive_fitting.html#redilation-fitting">Redilation fitting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pupil_fitting/08_comprehensive_fitting.html#summary-show-all-fits">Summary: show all fits</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pupil_fitting/08_comprehensive_fitting.html#convenience-wrapper-pupilfit">Convenience wrapper: PupilFit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pupil_fitting/08_comprehensive_fitting.html#compare-metrics-from-data-vs-fit">Compare metrics from data vs fit</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pupil_series.html">Pupil Measurement Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pupil_series/01_series_loading.html">Series loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pupil_series/02_series_exploration.html">Series Data Exploration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pupil_series/03_series_splitting.html">Series Splitting and Individual Measurements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pupil_series/04_series_fitting.html">Batch Preprocessing of Series Data</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Classes and Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html">pypipr.PupilMeasurement</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.__init__"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#id0"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.apply_baseline_correction"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.apply_baseline_correction()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.auc_early"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.auc_early()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.auc_late"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.auc_late()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.baseline"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.baseline()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.calculate_baseline"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.calculate_baseline()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.constriction_v"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.constriction_v()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.copy"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.copy()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.drop_nan"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.drop_nan()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.find_blinks"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.find_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.get_average_size"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.get_average_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.get_blinks"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.get_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.get_light_stimulus"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.get_light_stimulus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.get_rate_of_change"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.get_rate_of_change()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.get_size"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.get_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.get_time"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.get_time()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.interpolate"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.interpolate()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.limit_rate_of_change"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.limit_rate_of_change()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.net_pipr"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.net_pipr()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.peak_constriction"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.peak_constriction()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.pipr_6s"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.pipr_6s()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.pipr_duration"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.pipr_duration()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.pipr_xs"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.pipr_xs()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.plateau"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.plateau()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.plot"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.plot()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.plot_blinks"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.plot_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.plot_light_stimulus"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.plot_light_stimulus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.plr_latency"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.plr_latency()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.pupil_escape"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.pupil_escape()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.redilation_v"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.redilation_v()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.remove_blinks"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.remove_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.rolling_filter"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.rolling_filter()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.rolling_mean"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.rolling_mean()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.rolling_median"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.rolling_median()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.set_blinks"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.set_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.set_light_stimulus"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.set_light_stimulus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.set_time_and_size"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.set_time_and_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.set_time_offset"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.set_time_offset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.time_to_peak"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.time_to_peak()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.transient_plr"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.transient_plr()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.trim_size"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.trim_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilMeasurement.html#pypipr.PupilMeasurement.trim_time"><code class="docutils literal notranslate"><span class="pre">PupilMeasurement.trim_time()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html">pypipr.PupilSeries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries"><code class="docutils literal notranslate"><span class="pre">PupilSeries</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.__init__"><code class="docutils literal notranslate"><span class="pre">PupilSeries.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#id0"><code class="docutils literal notranslate"><span class="pre">PupilSeries.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.set_light_stimulus"><code class="docutils literal notranslate"><span class="pre">PupilSeries.set_light_stimulus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.get_light_stimulus"><code class="docutils literal notranslate"><span class="pre">PupilSeries.get_light_stimulus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.set_light_stimuli_from_list"><code class="docutils literal notranslate"><span class="pre">PupilSeries.set_light_stimuli_from_list()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.get_light_stimuli"><code class="docutils literal notranslate"><span class="pre">PupilSeries.get_light_stimuli()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.split"><code class="docutils literal notranslate"><span class="pre">PupilSeries.split()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.plot_light_stimulus"><code class="docutils literal notranslate"><span class="pre">PupilSeries.plot_light_stimulus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.copy"><code class="docutils literal notranslate"><span class="pre">PupilSeries.copy()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.drop_nan"><code class="docutils literal notranslate"><span class="pre">PupilSeries.drop_nan()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.find_blinks"><code class="docutils literal notranslate"><span class="pre">PupilSeries.find_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.get_blinks"><code class="docutils literal notranslate"><span class="pre">PupilSeries.get_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.get_rate_of_change"><code class="docutils literal notranslate"><span class="pre">PupilSeries.get_rate_of_change()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.get_size"><code class="docutils literal notranslate"><span class="pre">PupilSeries.get_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.get_time"><code class="docutils literal notranslate"><span class="pre">PupilSeries.get_time()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.interpolate"><code class="docutils literal notranslate"><span class="pre">PupilSeries.interpolate()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.limit_rate_of_change"><code class="docutils literal notranslate"><span class="pre">PupilSeries.limit_rate_of_change()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.plot"><code class="docutils literal notranslate"><span class="pre">PupilSeries.plot()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.plot_blinks"><code class="docutils literal notranslate"><span class="pre">PupilSeries.plot_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.remove_blinks"><code class="docutils literal notranslate"><span class="pre">PupilSeries.remove_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.rolling_filter"><code class="docutils literal notranslate"><span class="pre">PupilSeries.rolling_filter()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.rolling_mean"><code class="docutils literal notranslate"><span class="pre">PupilSeries.rolling_mean()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.rolling_median"><code class="docutils literal notranslate"><span class="pre">PupilSeries.rolling_median()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.set_blinks"><code class="docutils literal notranslate"><span class="pre">PupilSeries.set_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.set_time_and_size"><code class="docutils literal notranslate"><span class="pre">PupilSeries.set_time_and_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.set_time_offset"><code class="docutils literal notranslate"><span class="pre">PupilSeries.set_time_offset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.trim_size"><code class="docutils literal notranslate"><span class="pre">PupilSeries.trim_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilSeries.html#pypipr.PupilSeries.trim_time"><code class="docutils literal notranslate"><span class="pre">PupilSeries.trim_time()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html">pypipr.PupilFit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit"><code class="docutils literal notranslate"><span class="pre">PupilFit</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.__init__"><code class="docutils literal notranslate"><span class="pre">PupilFit.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#id0"><code class="docutils literal notranslate"><span class="pre">PupilFit.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.get_time"><code class="docutils literal notranslate"><span class="pre">PupilFit.get_time()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.get_size"><code class="docutils literal notranslate"><span class="pre">PupilFit.get_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.get_light_stimulus"><code class="docutils literal notranslate"><span class="pre">PupilFit.get_light_stimulus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.get_fits"><code class="docutils literal notranslate"><span class="pre">PupilFit.get_fits()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.predict"><code class="docutils literal notranslate"><span class="pre">PupilFit.predict()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.get_param"><code class="docutils literal notranslate"><span class="pre">PupilFit.get_param()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.get_all_params"><code class="docutils literal notranslate"><span class="pre">PupilFit.get_all_params()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.get_formula_strings"><code class="docutils literal notranslate"><span class="pre">PupilFit.get_formula_strings()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.apply_baseline_correction"><code class="docutils literal notranslate"><span class="pre">PupilFit.apply_baseline_correction()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.auc_early"><code class="docutils literal notranslate"><span class="pre">PupilFit.auc_early()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.auc_late"><code class="docutils literal notranslate"><span class="pre">PupilFit.auc_late()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.baseline"><code class="docutils literal notranslate"><span class="pre">PupilFit.baseline()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.calculate_baseline"><code class="docutils literal notranslate"><span class="pre">PupilFit.calculate_baseline()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.constriction_v"><code class="docutils literal notranslate"><span class="pre">PupilFit.constriction_v()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.copy"><code class="docutils literal notranslate"><span class="pre">PupilFit.copy()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.drop_nan"><code class="docutils literal notranslate"><span class="pre">PupilFit.drop_nan()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.find_blinks"><code class="docutils literal notranslate"><span class="pre">PupilFit.find_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.get_average_size"><code class="docutils literal notranslate"><span class="pre">PupilFit.get_average_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.get_blinks"><code class="docutils literal notranslate"><span class="pre">PupilFit.get_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.get_rate_of_change"><code class="docutils literal notranslate"><span class="pre">PupilFit.get_rate_of_change()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.interpolate"><code class="docutils literal notranslate"><span class="pre">PupilFit.interpolate()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.limit_rate_of_change"><code class="docutils literal notranslate"><span class="pre">PupilFit.limit_rate_of_change()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.net_pipr"><code class="docutils literal notranslate"><span class="pre">PupilFit.net_pipr()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.peak_constriction"><code class="docutils literal notranslate"><span class="pre">PupilFit.peak_constriction()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.pipr_6s"><code class="docutils literal notranslate"><span class="pre">PupilFit.pipr_6s()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.pipr_duration"><code class="docutils literal notranslate"><span class="pre">PupilFit.pipr_duration()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.pipr_xs"><code class="docutils literal notranslate"><span class="pre">PupilFit.pipr_xs()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.plateau"><code class="docutils literal notranslate"><span class="pre">PupilFit.plateau()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.plot"><code class="docutils literal notranslate"><span class="pre">PupilFit.plot()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.plot_blinks"><code class="docutils literal notranslate"><span class="pre">PupilFit.plot_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.plot_light_stimulus"><code class="docutils literal notranslate"><span class="pre">PupilFit.plot_light_stimulus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.plr_latency"><code class="docutils literal notranslate"><span class="pre">PupilFit.plr_latency()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.pupil_escape"><code class="docutils literal notranslate"><span class="pre">PupilFit.pupil_escape()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.redilation_v"><code class="docutils literal notranslate"><span class="pre">PupilFit.redilation_v()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.remove_blinks"><code class="docutils literal notranslate"><span class="pre">PupilFit.remove_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.rolling_filter"><code class="docutils literal notranslate"><span class="pre">PupilFit.rolling_filter()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.rolling_mean"><code class="docutils literal notranslate"><span class="pre">PupilFit.rolling_mean()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.rolling_median"><code class="docutils literal notranslate"><span class="pre">PupilFit.rolling_median()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.set_blinks"><code class="docutils literal notranslate"><span class="pre">PupilFit.set_blinks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.set_light_stimulus"><code class="docutils literal notranslate"><span class="pre">PupilFit.set_light_stimulus()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.set_time_and_size"><code class="docutils literal notranslate"><span class="pre">PupilFit.set_time_and_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.set_time_offset"><code class="docutils literal notranslate"><span class="pre">PupilFit.set_time_offset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.time_to_peak"><code class="docutils literal notranslate"><span class="pre">PupilFit.time_to_peak()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.transient_plr"><code class="docutils literal notranslate"><span class="pre">PupilFit.transient_plr()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.trim_size"><code class="docutils literal notranslate"><span class="pre">PupilFit.trim_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_autosummary/pypipr.PupilFit.html#pypipr.PupilFit.trim_time"><code class="docutils literal notranslate"><span class="pre">PupilFit.trim_time()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Information:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../license.html#copyright-information">Copyright Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../license.html#license-terms">License Terms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../license.html#mit-license">MIT License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../license.html#third-party-dependencies">Third-Party Dependencies</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Pypipr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../pupil_measurement.html">Pupil Measurement Examples</a></li>
      <li class="breadcrumb-item active">Preprocessing and Filtering</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/examples/example_ipynb/pupil_measurement/04_preprocessing_filtering.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="preprocessing-and-filtering">
<h1>Preprocessing and Filtering<a class="headerlink" href="#preprocessing-and-filtering" title="Link to this heading"></a></h1>
<p>This notebook demonstrates data cleaning and filtering techniques:</p>
<ul class="simple">
<li><p>Removing artifacts</p></li>
<li><p>Smoothing noisy data</p></li>
<li><p>Handling missing values</p></li>
<li><p>Rate limiting and outlier removal</p></li>
</ul>
<section id="how-to-use-this-notebook">
<h2>How to use this notebook<a class="headerlink" href="#how-to-use-this-notebook" title="Link to this heading"></a></h2>
<p>Run cells from top to bottom to follow a realistic preprocessing workflow: load simulated data, apply smoothing filters, inject synthetic blinks, and explore different strategies to handle them (filtering, removal, interpolation, trimming, rate limiting).</p>
<p>Note: the examples use <code class="docutils literal notranslate"><span class="pre">pypipr</span></code>’s helper functions and small simulated datasets so you can experiment without real recordings. Replace simulated signals with your own <code class="docutils literal notranslate"><span class="pre">PupilMeasurement</span></code> objects as needed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import necessary libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pypipr</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-a-noisy-example-signal">
<h2>Generate a noisy example signal<a class="headerlink" href="#generate-a-noisy-example-signal" title="Link to this heading"></a></h2>
<p>We create a simulated pupil measurement with moderate noise. This is the starting point for testing smoothing and artifact handling strategies. The plot shows the raw noisy trace with the light stimulus overlay.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Create simulated data with noise (Example 1)</span>
<span class="n">noisy_signal</span> <span class="o">=</span> <span class="n">pypipr</span><span class="o">.</span><span class="n">simulate_pupil_measurement</span><span class="p">(</span><span class="n">noise_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">trend_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

<span class="c1"># Plot the data</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">noisy_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Moderate noise&quot;</span><span class="p">)</span>
<span class="n">noisy_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/cab1fedf6caf81e1a0566b810d97eab763d72dc3b7b158d084972fef2627c246.png" src="../../../_images/cab1fedf6caf81e1a0566b810d97eab763d72dc3b7b158d084972fef2627c246.png" />
</div>
</div>
</section>
<section id="apply-simple-smoothing-filters">
<h2>Apply simple smoothing filters<a class="headerlink" href="#apply-simple-smoothing-filters" title="Link to this heading"></a></h2>
<p>Rolling mean and rolling median are two quick smoothing strategies. Compare their effect visually to decide which preserves features you care about (e.g., constriction transients). Adjust <code class="docutils literal notranslate"><span class="pre">time_window</span></code> to change smoothing strength.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s apply a few filters to the noisy signal</span>
<span class="n">noisy_signal</span> <span class="o">=</span> <span class="n">pypipr</span><span class="o">.</span><span class="n">simulate_pupil_measurement</span><span class="p">(</span><span class="n">noise_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">trend_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

<span class="c1"># Rolling mean</span>
<span class="n">rolling_mean_signal</span> <span class="o">=</span> <span class="n">noisy_signal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">rolling_mean_signal</span><span class="o">.</span><span class="n">rolling_mean</span><span class="p">(</span><span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Rolling median</span>
<span class="n">rolling_median_signal</span> <span class="o">=</span> <span class="n">noisy_signal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">rolling_median_signal</span><span class="o">.</span><span class="n">rolling_median</span><span class="p">(</span><span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">noisy_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Moderate noise&quot;</span><span class="p">)</span>
<span class="n">rolling_mean_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rolling mean&quot;</span><span class="p">)</span>
<span class="n">noisy_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Moderate noise&quot;</span><span class="p">)</span>
<span class="n">rolling_median_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rolling median&quot;</span><span class="p">)</span>

<span class="n">noisy_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">noisy_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1bc3746d590&gt;
</pre></div>
</div>
<img alt="../../../_images/05bdbfd5ba6e94fc8f1cb13e3f3bed955728cfc907cbb0151774e5d75d4cfe68.png" src="../../../_images/05bdbfd5ba6e94fc8f1cb13e3f3bed955728cfc907cbb0151774e5d75d4cfe68.png" />
</div>
</div>
</section>
<section id="inject-synthetic-blinks">
<h2>Inject synthetic blinks<a class="headerlink" href="#inject-synthetic-blinks" title="Link to this heading"></a></h2>
<p>To test blink-handling routines we add synthetic blink artifacts to the signal. The following code replaces parts of the trace with smooth quadratic shapes to simulate blinks and shows a comparison plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now let&#39;s add two blinks to the noisy data.</span>
<span class="n">blink_signal</span> <span class="o">=</span> <span class="n">pypipr</span><span class="o">.</span><span class="n">simulate_pupil_measurement</span><span class="p">(</span><span class="n">noise_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">trend_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">blink_size</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>

<span class="c1"># Create a blink by replacing part of the signal with a quadratic function</span>
<span class="n">size_during_blink_1</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">150</span><span class="p">:</span><span class="mi">200</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.1</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">150</span><span class="p">:</span><span class="mi">200</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_1</span>
<span class="n">size_during_blink_2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">350</span><span class="p">:</span><span class="mi">370</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.4</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">350</span><span class="p">:</span><span class="mi">370</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_2</span>
<span class="n">size_during_blink_3</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">615</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.1</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">615</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_3</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">set_time_and_size</span><span class="p">(</span><span class="n">blink_signal</span><span class="o">.</span><span class="n">get_time</span><span class="p">(),</span> <span class="n">blink_size</span><span class="p">)</span>

<span class="c1"># Plot blink comparison</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">noisy_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Moderate noise&quot;</span><span class="p">)</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With blink&quot;</span><span class="p">)</span>

<span class="n">noisy_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/c6851d12133cd6f4caa2ab0e7965ebb4761749ffa6488c49311a9c503452a2f6.png" src="../../../_images/c6851d12133cd6f4caa2ab0e7965ebb4761749ffa6488c49311a9c503452a2f6.png" />
</div>
</div>
</section>
<section id="try-smoothing-after-blink-injection">
<h2>Try smoothing after blink injection<a class="headerlink" href="#try-smoothing-after-blink-injection" title="Link to this heading"></a></h2>
<p>Apply the same mean/median filters to the blink-containing trace to see how well smoothing handles large artifacts. Often you’ll need additional strategies (removal or interpolation) when blinks are severe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recreate the blinked signal</span>
<span class="n">blink_signal</span> <span class="o">=</span> <span class="n">pypipr</span><span class="o">.</span><span class="n">simulate_pupil_measurement</span><span class="p">(</span><span class="n">noise_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">trend_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">blink_size</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>

<span class="c1"># Create a blink by replacing part of the signal with a quadratic function</span>
<span class="n">size_during_blink_1</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">150</span><span class="p">:</span><span class="mi">200</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.1</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">150</span><span class="p">:</span><span class="mi">200</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_1</span>
<span class="n">size_during_blink_2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">350</span><span class="p">:</span><span class="mi">370</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.4</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">350</span><span class="p">:</span><span class="mi">370</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_2</span>
<span class="n">size_during_blink_3</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">615</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.1</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">615</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_3</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">set_time_and_size</span><span class="p">(</span><span class="n">blink_signal</span><span class="o">.</span><span class="n">get_time</span><span class="p">(),</span> <span class="n">blink_size</span><span class="p">)</span>


<span class="c1"># Now we can try to filter the blinks using the mean and median filters again</span>
<span class="n">blink_rolling_mean_signal</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">blink_rolling_mean_signal</span><span class="o">.</span><span class="n">rolling_mean</span><span class="p">(</span><span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">blink_rolling_median_signal</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">blink_rolling_median_signal</span><span class="o">.</span><span class="n">rolling_median</span><span class="p">(</span><span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With blink&quot;</span><span class="p">)</span>
<span class="n">blink_rolling_mean_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rolling mean&quot;</span><span class="p">)</span>
<span class="n">blink_rolling_median_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rolling median&quot;</span><span class="p">)</span>

<span class="n">blink_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">blink_rolling_mean_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">blink_rolling_median_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/85409692db5279f7087914e59ff7b7f1121a46d7c6c56f722f4bc89ddbd8cccd.png" src="../../../_images/85409692db5279f7087914e59ff7b7f1121a46d7c6c56f722f4bc89ddbd8cccd.png" />
</div>
</div>
</section>
<section id="remove-blinks-by-marking-and-deleting-segments">
<h2>Remove blinks by marking and deleting segments<a class="headerlink" href="#remove-blinks-by-marking-and-deleting-segments" title="Link to this heading"></a></h2>
<p>If smoothing doesn’t remove large artifacts, mark blink intervals and remove them. You can then interpolate the missing sections to reconstruct a continuous trace. The example below shows marking, removal, and interpolation steps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recreate the blinked signal</span>
<span class="n">blink_signal</span> <span class="o">=</span> <span class="n">pypipr</span><span class="o">.</span><span class="n">simulate_pupil_measurement</span><span class="p">(</span><span class="n">noise_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">trend_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">blink_size</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>

<span class="c1"># Create a blink by replacing part of the signal with a quadratic function</span>
<span class="n">size_during_blink_1</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">150</span><span class="p">:</span><span class="mi">200</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.1</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">150</span><span class="p">:</span><span class="mi">200</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_1</span>
<span class="n">size_during_blink_2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">350</span><span class="p">:</span><span class="mi">370</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.4</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">350</span><span class="p">:</span><span class="mi">370</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_2</span>
<span class="n">size_during_blink_3</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">615</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.1</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">615</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_3</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">set_time_and_size</span><span class="p">(</span><span class="n">blink_signal</span><span class="o">.</span><span class="n">get_time</span><span class="p">(),</span> <span class="n">blink_size</span><span class="p">)</span>

<span class="c1"># If filtering is not sufficient, we can also remove the blinks.</span>
<span class="n">blink_removed_signal</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Blink 1: Start at </span><span class="si">{</span><span class="n">time</span><span class="p">[</span><span class="mi">150</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> s, end at </span><span class="si">{</span><span class="n">time</span><span class="p">[</span><span class="mi">200</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Blink 2: Start at </span><span class="si">{</span><span class="n">time</span><span class="p">[</span><span class="mi">350</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> s, end at </span><span class="si">{</span><span class="n">time</span><span class="p">[</span><span class="mi">370</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Blink 3: Start at </span><span class="si">{</span><span class="n">time</span><span class="p">[</span><span class="mi">600</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> s, end at </span><span class="si">{</span><span class="n">time</span><span class="p">[</span><span class="mi">615</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
<span class="n">blink_list</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.6</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">)]</span>

<span class="n">blink_removed_signal</span><span class="o">.</span><span class="n">set_blinks</span><span class="p">(</span><span class="n">blink_list</span><span class="p">)</span>
<span class="n">blink_removed_signal</span><span class="o">.</span><span class="n">remove_blinks</span><span class="p">()</span>


<span class="n">interpolated_blinks_signal</span> <span class="o">=</span> <span class="n">blink_removed_signal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">interpolated_blinks_signal</span><span class="o">.</span><span class="n">drop_nan</span><span class="p">()</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">interpolated_blinks_signal</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With blink&quot;</span><span class="p">)</span>
<span class="n">blink_removed_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Blinks removed&quot;</span><span class="p">)</span>
<span class="n">interpolated_blinks_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Blinks interpolated&quot;</span><span class="p">)</span>

<span class="n">blink_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">blink_removed_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">interpolated_blinks_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Blink 1: Start at -7.0 s, end at -6.0 s
Blink 2: Start at -3.0 s, end at -2.6 s
Blink 3: Start at 2.0 s, end at 2.3 s
</pre></div>
</div>
<img alt="../../../_images/4eac6992628e0b46cedb8cec5dc72eaa8597821eb3bd5415a894693614212bf2.png" src="../../../_images/4eac6992628e0b46cedb8cec5dc72eaa8597821eb3bd5415a894693614212bf2.png" />
</div>
</div>
</section>
<section id="trim-by-pupil-size">
<h2>Trim by pupil size<a class="headerlink" href="#trim-by-pupil-size" title="Link to this heading"></a></h2>
<p>An alternative is to trim data by size thresholds around suspected blink times. This can be faster when you know expected pupil ranges. The snippet below demonstrates trimming specific intervals by size range.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recreate the blinked signal</span>
<span class="n">blink_signal</span> <span class="o">=</span> <span class="n">pypipr</span><span class="o">.</span><span class="n">simulate_pupil_measurement</span><span class="p">(</span><span class="n">noise_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">trend_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">blink_size</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>

<span class="c1"># Create a blink by replacing part of the signal with a quadratic function</span>
<span class="n">size_during_blink_1</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">150</span><span class="p">:</span><span class="mi">200</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.1</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">150</span><span class="p">:</span><span class="mi">200</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_1</span>
<span class="n">size_during_blink_2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">350</span><span class="p">:</span><span class="mi">370</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.4</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">350</span><span class="p">:</span><span class="mi">370</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_2</span>
<span class="n">size_during_blink_3</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">615</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.1</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">615</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_3</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">set_time_and_size</span><span class="p">(</span><span class="n">blink_signal</span><span class="o">.</span><span class="n">get_time</span><span class="p">(),</span> <span class="n">blink_size</span><span class="p">)</span>
<span class="c1"># Another way to remove blinks or other outliers is by trimming the size.</span>
<span class="n">trimmed_signal</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Removing the second blink</span>
<span class="n">trimmed_signal</span><span class="o">.</span><span class="n">trim_size</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">)</span>
<span class="c1"># Removing the third blink</span>
<span class="n">trimmed_signal</span><span class="o">.</span><span class="n">trim_size</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With blink&quot;</span><span class="p">)</span>
<span class="n">trimmed_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;brown&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trimmed size&quot;</span><span class="p">)</span>

<span class="n">blink_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">trimmed_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1bc38b80190&gt;
</pre></div>
</div>
<img alt="../../../_images/501a721ef824ae1e51efa43c3df359a984ec2fb4ade682765eba7b286c6ebced.png" src="../../../_images/501a721ef824ae1e51efa43c3df359a984ec2fb4ade682765eba7b286c6ebced.png" />
</div>
</div>
</section>
<section id="limit-sudden-rates-of-change">
<h2>Limit sudden rates of change<a class="headerlink" href="#limit-sudden-rates-of-change" title="Link to this heading"></a></h2>
<p>Finally, limiting the maximum rate of change can suppress abrupt blink-like transitions while preserving physiologically plausible pupil dynamics around stimulus periods. Use <code class="docutils literal notranslate"><span class="pre">limit_rate_of_change</span></code> selectively so you don’t remove real fast responses.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recreate the blinked signal</span>
<span class="n">blink_signal</span> <span class="o">=</span> <span class="n">pypipr</span><span class="o">.</span><span class="n">simulate_pupil_measurement</span><span class="p">(</span><span class="n">noise_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">trend_std</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">blink_size</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>

<span class="c1"># Create a blink by replacing part of the signal with a quadratic function</span>
<span class="n">size_during_blink_1</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">150</span><span class="p">:</span><span class="mi">200</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.1</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">150</span><span class="p">:</span><span class="mi">200</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_1</span>
<span class="n">size_during_blink_2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">350</span><span class="p">:</span><span class="mi">370</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.4</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">350</span><span class="p">:</span><span class="mi">370</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_2</span>
<span class="n">size_during_blink_3</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blink_size</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">615</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.1</span>
<span class="p">)</span>
<span class="n">blink_size</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">615</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_during_blink_3</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">set_time_and_size</span><span class="p">(</span><span class="n">blink_signal</span><span class="o">.</span><span class="n">get_time</span><span class="p">(),</span> <span class="n">blink_size</span><span class="p">)</span>

<span class="c1"># Finally, we can remove blinks by limiting the rate of change.</span>
<span class="n">rate_limited_signal</span> <span class="o">=</span> <span class="n">blink_signal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># We don&#39;t limit the rate of change between -1 s and 0 s to preserve the constriction response to the light stimulus.</span>
<span class="n">rate_limited_signal</span><span class="o">.</span><span class="n">limit_rate_of_change</span><span class="p">(</span>
    <span class="n">max_rate_of_change</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">rate_limited_signal</span><span class="o">.</span><span class="n">limit_rate_of_change</span><span class="p">(</span>
    <span class="n">max_rate_of_change</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With blink&quot;</span><span class="p">)</span>
<span class="n">rate_limited_signal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;magenta&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rate limited&quot;</span><span class="p">)</span>
<span class="n">blink_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">rate_limited_signal</span><span class="o">.</span><span class="n">plot_light_stimulus</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1bc37683390&gt;
</pre></div>
</div>
<img alt="../../../_images/c8223a05bfa17be34b9027168abaec947d1dd87aabac226a58742e7672283703.png" src="../../../_images/c8223a05bfa17be34b9027168abaec947d1dd87aabac226a58742e7672283703.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="02_data_loading.html" class="btn btn-neutral float-left" title="Data Loading Techniques" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="05_baseline_correction.html" class="btn btn-neutral float-right" title="Baseline Correction Techniques" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, S. Belgers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>